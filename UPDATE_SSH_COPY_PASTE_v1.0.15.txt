================================================================================
SCRIPT UPDATE APLIKASI KE v1.0.15 - COPY PASTE KE PUTTY
================================================================================

CARA PENGGUNAAN:
1. Buka PuTTY dan connect ke server: ssh root@8.215.192.2
2. Copy command di bawah ini (satu baris panjang)
3. Paste ke PuTTY terminal (Right-click atau Shift+Insert)
4. Tekan Enter untuk menjalankan

================================================================================
UPDATE KE VERSI v1.0.15 (RECOMMENDED)
================================================================================

cd /www/wwwroot/8.215.192.2 && echo "==========================================" && echo "Update Live Server UJAN to v1.0.15" && echo "==========================================" && echo "" && echo "1. Checking current version..." && CURRENT_VERSION=$(php -r "require 'config/config.php'; echo APP_VERSION;" 2>/dev/null || echo "unknown") && echo "   Current version: $CURRENT_VERSION" && echo "" && echo "2. Stashing local changes..." && git stash push -m "Auto stash before update v1.0.15 $(date +%Y%m%d_%H%M%S)" 2>/dev/null || echo "   No local changes to stash" && echo "" && echo "3. Fetching latest changes from GitHub..." && git fetch origin main && git fetch --tags && echo "" && echo "4. Checking out version v1.0.15..." && git checkout v1.0.15 2>/dev/null || (echo "   Version v1.0.15 not found, updating to latest..." && git reset --hard origin/main) && echo "" && echo "5. Setting permissions..." && chown -R www:www . 2>/dev/null || echo "   Warning: Failed to set ownership (bisa diabaikan jika bukan root)" && find . -type f -exec chmod 644 {} \; 2>/dev/null || true && find . -type d -exec chmod 755 {} \; 2>/dev/null || true && echo "" && echo "6. Clearing cache..." && rm -rf cache/*.json cache/*.cache 2>/dev/null || true && echo "" && echo "7. Verifying update..." && if [ -f config/config.php ]; then NEW_VERSION=$(php -r "require 'config/config.php'; echo APP_VERSION;" 2>/dev/null); if [ -z "$NEW_VERSION" ]; then NEW_VERSION=$(git describe --tags --abbrev=0 2>/dev/null | sed 's/^v//'); fi; if [ -z "$NEW_VERSION" ]; then NEW_VERSION="unknown"; fi; echo "   New version: $NEW_VERSION"; if [ "$CURRENT_VERSION" != "$NEW_VERSION" ]; then echo "   ✓ Version updated from $CURRENT_VERSION to $NEW_VERSION"; else echo "   ⚠ Version unchanged"; fi; else echo "   ✗ config/config.php not found"; fi && echo "" && echo "==========================================" && echo "Update completed!" && echo "==========================================" && echo "" && echo "Test aplikasi:" && echo "  - Root URL: http://8.215.192.2/" && echo "  - Login: http://8.215.192.2/login" && echo "  - Admin: http://8.215.192.2/admin-about" && echo "" && echo "Version: $NEW_VERSION" && echo ""

================================================================================
UPDATE KE LATEST VERSION (Jika v1.0.15 belum ada di GitHub)
================================================================================

cd /www/wwwroot/8.215.192.2 && echo "==========================================" && echo "Update Live Server UJAN to Latest" && echo "==========================================" && echo "" && echo "1. Checking current version..." && CURRENT_VERSION=$(php -r "require 'config/config.php'; echo APP_VERSION;" 2>/dev/null || echo "unknown") && echo "   Current version: $CURRENT_VERSION" && echo "" && echo "2. Stashing local changes..." && git stash push -m "Auto stash before update $(date +%Y%m%d_%H%M%S)" 2>/dev/null || echo "   No local changes to stash" && echo "" && echo "3. Fetching latest changes from GitHub..." && git fetch origin main && git fetch --tags && echo "" && echo "4. Updating to latest from main branch..." && git reset --hard origin/main && echo "" && echo "5. Setting permissions..." && chown -R www:www . 2>/dev/null || echo "   Warning: Failed to set ownership (bisa diabaikan jika bukan root)" && find . -type f -exec chmod 644 {} \; 2>/dev/null || true && find . -type d -exec chmod 755 {} \; 2>/dev/null || true && echo "" && echo "6. Clearing cache..." && rm -rf cache/*.json cache/*.cache 2>/dev/null || true && echo "" && echo "7. Verifying update..." && if [ -f config/config.php ]; then NEW_VERSION=$(php -r "require 'config/config.php'; echo APP_VERSION;" 2>/dev/null); if [ -z "$NEW_VERSION" ]; then NEW_VERSION=$(git describe --tags --abbrev=0 2>/dev/null | sed 's/^v//'); fi; if [ -z "$NEW_VERSION" ]; then NEW_VERSION="unknown"; fi; echo "   New version: $NEW_VERSION"; if [ "$CURRENT_VERSION" != "$NEW_VERSION" ]; then echo "   ✓ Version updated from $CURRENT_VERSION to $NEW_VERSION"; else echo "   ⚠ Version unchanged"; fi; else echo "   ✗ config/config.php not found"; fi && echo "" && echo "==========================================" && echo "Update completed!" && echo "==========================================" && echo "" && echo "Test aplikasi:" && echo "  - Root URL: http://8.215.192.2/" && echo "  - Login: http://8.215.192.2/login" && echo "  - Admin: http://8.215.192.2/admin-about" && echo "" && echo "Version: $NEW_VERSION" && echo ""

================================================================================
VERSI SEDERHANA (MINIMAL OUTPUT)
================================================================================

cd /www/wwwroot/8.215.192.2 && git stash push -m "Auto stash $(date +%Y%m%d_%H%M%S)" 2>/dev/null || true && git fetch origin main && git fetch --tags && git checkout v1.0.15 2>/dev/null || git reset --hard origin/main && chown -R www:www . 2>/dev/null || true && find . -type f -exec chmod 644 {} \; 2>/dev/null || true && find . -type d -exec chmod 755 {} \; 2>/dev/null || true && rm -rf cache/*.json cache/*.cache 2>/dev/null || true && echo "Update completed! Version: $(php -r "require 'config/config.php'; echo APP_VERSION;" 2>/dev/null || git describe --tags --abbrev=0 2>/dev/null | sed 's/^v//' || echo 'unknown')"

================================================================================
CHECK VERSION SETELAH UPDATE
================================================================================

cd /www/wwwroot/8.215.192.2 && php -r "require 'config/config.php'; echo 'Version: ' . APP_VERSION . PHP_EOL;"

ATAU

cd /www/wwwroot/8.215.192.2 && git describe --tags --abbrev=0

================================================================================
BACKUP DATABASE SEBELUM UPDATE (OPSIONAL)
================================================================================

cd /www/wwwroot/8.215.192.2 && BACKUP_DATE=$(date +%Y%m%d_%H%M%S) && mkdir -p ../backups && mysqldump -u DB_USER -pDB_PASS DB_NAME > ../backups/database_backup_${BACKUP_DATE}.sql && echo "Database backup created: ../backups/database_backup_${BACKUP_DATE}.sql"

*(Ganti DB_USER, DB_PASS, DB_NAME dengan credentials database Anda)*

================================================================================
TROUBLESHOOTING
================================================================================

Jika error "Permission denied":
  cd /www/wwwroot/8.215.192.2 && chown -R www:www . && find . -type f -exec chmod 644 {} \; && find . -type d -exec chmod 755 {} \;

Jika error "Git repository not found":
  cd /www/wwwroot/8.215.192.2 && git init && git remote add origin https://github.com/adiprayitno160-svg/ujian.git && git fetch origin main && git checkout -b main origin/main

Jika error "Version v1.0.15 not found":
  cd /www/wwwroot/8.215.192.2 && git fetch --tags && git checkout v1.0.15

Jika error "Failed to update":
  cd /www/wwwroot/8.215.192.2 && git status && git fetch origin main && git reset --hard origin/main

================================================================================
TIPS
================================================================================

1. Pastikan sudah login ke server sebelum paste command
2. Copy seluruh command (satu baris panjang)
3. Paste ke PuTTY dengan Right-click atau Shift+Insert
4. Tunggu proses selesai (bisa beberapa detik)
5. Check output untuk memastikan update berhasil
6. Test aplikasi di browser setelah update
7. Check version dengan command di atas

================================================================================

